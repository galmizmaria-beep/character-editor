<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Редактор: Битва с Боссом</title>
<style>
  /* --- ШРИФТЫ И БАЗОВЫЙ СТИЛЬ --- */
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rajdhani:wght@600;700&family=Roboto:wght@400;700&display=swap');

  :root {
    --bg-dark: #121214;
    --bg-panel: #1e1e24;
    --primary: #ffd700; /* Gold */
    --hero-color: #00e5ff; /* Cyan */
    --boss-color: #ff0055; /* Red */
    --text: #ffffff;
    --border: rgba(255, 255, 255, 0.1);
  }

  body {
    margin: 0; padding: 0;
    background-color: var(--bg-dark);
    color: var(--text);
    font-family: 'Roboto', sans-serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* --- ШАПКА --- */
  header {
    height: 60px;
    background: #000;
    border-bottom: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    flex-shrink: 0;
  }
  .app-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 14px;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 1px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .lang-switch {
    display: flex;
    gap: 5px;
  }
  .lang-btn {
    background: #333;
    border: 1px solid #555;
    color: #888;
    padding: 5px 10px;
    cursor: pointer;
    font-size: 10px;
    font-weight: bold;
    border-radius: 4px;
  }
  .lang-btn.active {
    background: var(--primary);
    color: #000;
    border-color: var(--primary);
  }

  /* --- ОСНОВНОЙ МАКЕТ --- */
  .main-container {
    display: flex;
    flex: 1;
    overflow: hidden;
  }

  /* ЛЕВАЯ ПАНЕЛЬ (НАСТРОЙКИ) */
  .sidebar {
    width: 350px;
    background: var(--bg-panel);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    flex-shrink: 0;
  }

  .tabs {
    display: flex;
    background: #111;
  }
  .tab-btn {
    flex: 1;
    padding: 15px;
    background: transparent;
    border: none;
    color: #666;
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: 0.2s;
  }
  .tab-btn.active {
    color: #fff;
    background: #222;
  }
  .tab-btn[data-tab="hero"].active { border-bottom-color: var(--hero-color); }
  .tab-btn[data-tab="boss"].active { border-bottom-color: var(--boss-color); }
  .tab-btn[data-tab="quest"].active { border-bottom-color: var(--primary); }

  .panel-content {
    padding: 20px;
    display: none;
    flex-direction: column;
    gap: 20px;
  }
  .panel-content.active { display: flex; }

  /* Элементы управления */
  .control-group {
    background: rgba(0,0,0,0.2);
    padding: 15px;
    border-radius: 6px;
    border: 1px solid var(--border);
  }
  label {
    display: block;
    font-size: 11px;
    text-transform: uppercase;
    color: #aaa;
    margin-bottom: 8px;
    font-weight: bold;
    font-family: 'Rajdhani', sans-serif;
    letter-spacing: 1px;
  }
  input[type="text"], textarea {
    width: 100%;
    background: #000;
    border: 1px solid #444;
    color: #fff;
    padding: 10px;
    border-radius: 4px;
    font-size: 13px;
    margin-bottom: 5px;
  }
  input[type="text"]:focus { border-color: var(--primary); outline: none; }
  
  .file-drop {
    border: 2px dashed #444;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: 0.2s;
    border-radius: 4px;
    font-size: 11px;
    color: #888;
  }
  .file-drop:hover { border-color: var(--text); color: var(--text); }
  input[type="file"] { display: none; }

  .answers-list { display: flex; flex-direction: column; gap: 10px; }
  .ans-row { display: flex; gap: 5px; align-items: center; }
  .ans-marker { width: 10px; height: 10px; border-radius: 50%; }
  .ans-correct { background: #00ff88; box-shadow: 0 0 5px #00ff88; }
  .ans-wrong { background: #ff0055; }

  /* ПРАВАЯ ПАНЕЛЬ (ПРЕВЬЮ) */
  .preview-area {
    flex: 1;
    background: #050505;
    background-image: 
        linear-gradient(rgba(0, 255, 100, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 255, 100, 0.03) 1px, transparent 1px);
    background-size: 50px 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    padding: 20px;
  }

  /* Сцена Игры (Визуализация того, что будет в Genially) */
  .game-stage {
    width: 100%;
    max-width: 800px;
    aspect-ratio: 16 / 9;
    background: url('https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=2070&auto=format&fit=crop') center/cover;
    position: relative;
    border: 2px solid #333;
    box-shadow: 0 0 50px rgba(0,0,0,0.7);
    overflow: hidden;
    font-family: 'Rajdhani', sans-serif;
  }
  /* Затемнение фона игры */
  .game-stage::before {
    content: ''; position: absolute; inset: 0; background: rgba(0,0,0,0.6);
  }

  /* HUD */
  .hud-top {
    position: absolute; top: 20px; left: 20px; right: 20px;
    display: flex; justify-content: space-between;
    z-index: 5;
  }
  .hp-box { width: 40%; }
  .hp-name { color: #fff; font-size: 14px; font-weight: 800; text-transform: uppercase; margin-bottom: 5px; text-shadow: 2px 2px 0 #000; }
  .hp-bar-bg { width: 100%; height: 12px; background: #333; border: 2px solid #fff; border-radius: 6px; overflow: hidden; }
  .hp-fill { height: 100%; width: 100%; transition: width 0.3s; }
  .hp-hero .hp-fill { background: var(--hero-color); }
  .hp-boss .hp-fill { background: var(--boss-color); }

  /* Characters */
  .chars-layer {
    position: absolute; top: 15%; bottom: 35%; left: 5%; right: 5%;
    display: flex; justify-content: space-between; align-items: flex-end;
    z-index: 2;
  }
  .char-sprite {
    max-height: 100%; max-width: 40%;
    filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
    transition: transform 0.2s, filter 0.2s;
  }
  .char-hero { animation: anim-idle 3s ease-in-out infinite; }
  .char-boss { animation: anim-idle 4s ease-in-out infinite reverse; }

  /* Battle Menu (Bottom) */
  .battle-ui {
    position: absolute; bottom: 0; left: 0; width: 100%; height: 35%;
    background: linear-gradient(to top, #000 90%, transparent);
    z-index: 10;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 10px 20px;
  }
  .dialog-box {
    background: rgba(0, 40, 80, 0.8);
    border: 2px solid var(--hero-color);
    width: 90%;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
    color: #fff;
    font-size: 16px;
    text-align: center;
    min-height: 40px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 15px rgba(0, 229, 255, 0.2);
  }
  .actions-grid {
    display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; width: 100%;
  }
  .action-btn {
    background: linear-gradient(180deg, #333, #111);
    border: 1px solid #666;
    color: #fff;
    padding: 8px 20px;
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700;
    font-size: 14px;
    text-transform: uppercase;
    cursor: default; /* В превью не кликаем */
    border-radius: 4px;
    min-width: 120px;
  }
  .action-btn.correct-preview { border-color: var(--primary); color: var(--primary); }

  /* АНИМАЦИИ ДЛЯ ПРЕВЬЮ */
  @keyframes anim-idle { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

  /* FOOTER (КНОПКА КОПИРОВАНИЯ) */
  .footer-bar {
    position: absolute; bottom: 20px; z-index: 50;
    width: 100%; display: flex; justify-content: center; pointer-events: none;
  }
  .btn-copy {
    pointer-events: auto;
    background: var(--primary);
    color: #000;
    border: none;
    padding: 15px 50px;
    font-family: 'Press Start 2P', cursive;
    font-size: 12px;
    cursor: pointer;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
    transition: 0.3s;
    border: 2px solid #fff;
  }
  .btn-copy:hover { transform: scale(1.05); box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
  .btn-copy:active { transform: scale(0.95); }
  
  /* Скрытый textarea для генерации */
  #code-buffer { position: absolute; left: -9999px; }

</style>
</head>
<body>

  <!-- ШАПКА -->
  <header>
    <div class="app-title">
      <span style="font-size:24px;">⚔️</span>
      <span id="ui-title">БИТВА С БОССОМ</span>
    </div>
    <div class="lang-switch">
      <button class="lang-btn active" onclick="setAppLang('ru')">RU</button>
      <button class="lang-btn" onclick="setAppLang('en')">EN</button>
    </div>
  </header>

  <!-- КОНТЕЙНЕР -->
  <div class="main-container">
    
    <!-- СЛЕВА: НАСТРОЙКИ -->
    <div class="sidebar">
      <div class="tabs">
        <button class="tab-btn active" data-tab="hero" onclick="switchTab('hero')">ГЕРОЙ</button>
        <button class="tab-btn" data-tab="boss" onclick="switchTab('boss')">БОСС</button>
        <button class="tab-btn" data-tab="quest" onclick="switchTab('quest')">КВЕСТ</button>
      </div>

      <!-- Вкладка ГЕРОЙ -->
      <div class="panel-content active" id="panel-hero">
        <div class="control-group">
          <label id="lbl-hero-name">Имя Героя</label>
          <input type="text" id="inp-hero-name" value="Student Lvl.1" oninput="updatePreview()">
        </div>
        <div class="control-group">
          <label id="lbl-hero-img">Аватар Героя</label>
          <div class="file-drop" onclick="document.getElementById('file-hero').click()">
             <span id="txt-drop">Нажми, чтобы загрузить файл</span>
          </div>
          <input type="file" id="file-hero" accept="image/*" onchange="handleFile(this, 'hero')">
          <label style="margin-top:10px;">Или ссылка (URL)</label>
          <input type="text" id="url-hero" placeholder="https://..." oninput="handleUrl(this, 'hero')">
        </div>
      </div>

      <!-- Вкладка БОСС -->
      <div class="panel-content" id="panel-boss">
        <div class="control-group">
          <label id="lbl-boss-name">Имя Босса</label>
          <input type="text" id="inp-boss-name" value="BOSS 9000" oninput="updatePreview()">
        </div>
        <div class="control-group">
          <label id="lbl-boss-img">Аватар Босса</label>
          <div class="file-drop" onclick="document.getElementById('file-boss').click()">
             <span id="txt-drop2">Нажми, чтобы загрузить файл</span>
          </div>
          <input type="file" id="file-boss" accept="image/*" onchange="handleFile(this, 'boss')">
          <label style="margin-top:10px;">Или ссылка (URL)</label>
          <input type="text" id="url-boss" placeholder="https://..." oninput="handleUrl(this, 'boss')">
        </div>
        <div class="control-group">
          <label id="lbl-win-msg">Сообщение Победы</label>
          <input type="text" id="inp-win-msg" value="VICTORY! +100 XP">
        </div>
      </div>

      <!-- Вкладка КВЕСТ -->
      <div class="panel-content" id="panel-quest">
        <div class="control-group">
          <label id="lbl-question">Вопрос / Атака</label>
          <textarea id="inp-question" rows="3" oninput="updatePreview()">2 + 2 * 2 = ?</textarea>
        </div>
        
        <div class="control-group">
          <label id="lbl-correct" style="color:#00ff88">Верный ответ (Крит. Удар)</label>
          <div class="ans-row">
            <div class="ans-marker ans-correct"></div>
            <input type="text" id="inp-ans-cor" value="6" oninput="updatePreview()">
          </div>
        </div>

        <div class="control-group">
          <label id="lbl-wrong" style="color:#ff0055">Неверные ответы (Промахи)</label>
          <div class="answers-list">
            <div class="ans-row">
              <div class="ans-marker ans-wrong"></div>
              <input type="text" class="wrong-ans" value="8" oninput="updatePreview()">
            </div>
            <div class="ans-row">
              <div class="ans-marker ans-wrong"></div>
              <input type="text" class="wrong-ans" value="4" oninput="updatePreview()">
            </div>
            <div class="ans-row">
              <div class="ans-marker ans-wrong"></div>
              <input type="text" class="wrong-ans" placeholder="(необязательно)" oninput="updatePreview()">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- СПРАВА: ПРЕВЬЮ -->
    <div class="preview-area">
      <div class="game-stage">
        
        <!-- Верхняя панель HP -->
        <div class="hud-top">
          <div class="hp-box hp-hero">
            <div class="hp-name" id="prev-hero-name">HERO</div>
            <div class="hp-bar-bg"><div class="hp-fill"></div></div>
          </div>
          <div class="hp-box hp-boss">
            <div class="hp-name" id="prev-boss-name" style="text-align:right">BOSS</div>
            <div class="hp-bar-bg"><div class="hp-fill"></div></div>
          </div>
        </div>

        <!-- Сцена с персонажами -->
        <div class="chars-layer">
          <img src="https://i.ibb.co/6rQ61q5/hero-placeholder.png" class="char-sprite char-hero" id="prev-hero-img" alt="Hero">
          <img src="https://i.ibb.co/9gJ720j/boss-placeholder.png" class="char-sprite char-boss" id="prev-boss-img" alt="Boss">
        </div>

        <!-- Меню битвы (внизу) -->
        <div class="battle-ui">
          <div class="dialog-box" id="prev-question">
            Ready to fight?
          </div>
          <div class="actions-grid" id="prev-buttons">
            <!-- Кнопки генерируются JS -->
          </div>
        </div>

      </div>

      <div class="footer-bar">
        <button class="btn-copy" onclick="generateAndCopy()">СКОПИРОВАТЬ КОД</button>
      </div>
    </div>
  </div>

  <textarea id="code-buffer"></textarea>

<script>
  /* --- ДАННЫЕ И СОСТОЯНИЕ --- */
  const state = {
    heroName: "Student",
    bossName: "Boss",
    heroImg: "https://cdn-icons-png.flaticon.com/512/3408/3408506.png", // Заглушка
    bossImg: "https://cdn-icons-png.flaticon.com/512/2312/2312264.png", // Заглушка
    question: "Вопрос...",
    correct: "Ответ",
    wrongs: ["Неверно 1", "Неверно 2"],
    winMsg: "VICTORY!"
  };

  const text = {
    ru: {
      title: "БИТВА С БОССОМ",
      tabs: ["ГЕРОЙ", "БОСС", "КВЕСТ"],
      labels: ["Имя Героя", "Аватар Героя", "Имя Босса", "Аватар Босса", "Сообщение Победы", "Вопрос / Атака", "Верный ответ", "Неверные ответы"],
      drop: "Нажми, чтобы загрузить файл",
      copy: "СКОПИРОВАТЬ КОД"
    },
    en: {
      title: "BOSS BATTLE",
      tabs: ["HERO", "BOSS", "QUEST"],
      labels: ["Hero Name", "Hero Avatar", "Boss Name", "Boss Avatar", "Win Message", "Question / Attack", "Correct Answer (Crit)", "Wrong Answers (Miss)"],
      drop: "Click to upload file",
      copy: "COPY CODE"
    }
  };

  /* --- ИНИЦИАЛИЗАЦИЯ --- */
  function init() {
    updatePreview();
  }

  /* --- ЛОГИКА ИНТЕРФЕЙСА --- */
  function setAppLang(lang) {
    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    
    const t = text[lang];
    document.getElementById('ui-title').innerText = t.title;
    
    const tabs = document.querySelectorAll('.tab-btn');
    tabs[0].innerText = t.tabs[0];
    tabs[1].innerText = t.tabs[1];
    tabs[2].innerText = t.tabs[2];

    document.getElementById('lbl-hero-name').innerText = t.labels[0];
    document.getElementById('lbl-hero-img').innerText = t.labels[1];
    document.getElementById('lbl-boss-name').innerText = t.labels[2];
    document.getElementById('lbl-boss-img').innerText = t.labels[3];
    document.getElementById('lbl-win-msg').innerText = t.labels[4];
    document.getElementById('lbl-question').innerText = t.labels[5];
    document.getElementById('lbl-correct').innerText = t.labels[6];
    document.getElementById('lbl-wrong').innerText = t.labels[7];
    
    document.getElementById('txt-drop').innerText = t.drop;
    document.getElementById('txt-drop2').innerText = t.drop;
    document.querySelector('.btn-copy').innerText = t.copy;
  }

  function switchTab(tabName) {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelector(`.tab-btn[data-tab="${tabName}"]`).classList.add('active');
    
    document.querySelectorAll('.panel-content').forEach(p => p.classList.remove('active'));
    document.getElementById(`panel-${tabName}`).classList.add('active');
  }

  function handleUrl(input, type) {
    if(input.value) {
      if(type === 'hero') state.heroImg = input.value;
      if(type === 'boss') state.bossImg = input.value;
      updatePreview();
    }
  }

  function handleFile(input, type) {
    const file = input.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        if(type === 'hero') state.heroImg = e.target.result;
        if(type === 'boss') state.bossImg = e.target.result;
        updatePreview();
      };
      reader.readAsDataURL(file);
    }
  }

  function updatePreview() {
    // Сбор данных
    state.heroName = document.getElementById('inp-hero-name').value;
    state.bossName = document.getElementById('inp-boss-name').value;
    state.winMsg = document.getElementById('inp-win-msg').value;
    state.question = document.getElementById('inp-question').value;
    state.correct = document.getElementById('inp-ans-cor').value;
    
    const wrongs = [];
    document.querySelectorAll('.wrong-ans').forEach(inp => {
      if(inp.value.trim() !== "") wrongs.push(inp.value);
    });
    state.wrongs = wrongs;

    // Обновление DOM Превью
    document.getElementById('prev-hero-name').innerText = state.heroName;
    document.getElementById('prev-boss-name').innerText = state.bossName;
    document.getElementById('prev-hero-img').src = state.heroImg;
    document.getElementById('prev-boss-img').src = state.bossImg;
    document.getElementById('prev-question').innerText = state.question;

    const btnContainer = document.getElementById('prev-buttons');
    btnContainer.innerHTML = '';
    
    // Создаем кнопки для превью
    const allAns = [{txt: state.correct, cor: true}, ...state.wrongs.map(w => ({txt: w, cor: false}))];
    allAns.forEach(a => {
      const b = document.createElement('div');
      b.className = 'action-btn' + (a.cor ? ' correct-preview' : '');
      b.innerText = a.txt;
      btnContainer.appendChild(b);
    });
  }

  /* --- ГЕНЕРАЦИЯ КОДА (САМОЕ ВАЖНОЕ) --- */
  function generateAndCopy() {
    // Собираем все ответы и перемешиваем для финальной игры
    const answers = [
      { t: state.correct, v: 1 },
      ...state.wrongs.map(w => ({ t: w, v: 0 }))
    ].sort(() => Math.random() - 0.5);

    // Генерируем HTML кнопки
    let buttonsHtml = '';
    answers.forEach(a => {
      buttonsHtml += `<button class="game-btn" onclick="attack(${a.v})">${a.t}</button>`;
    });

    // Полный код игры, который будет внутри iframe
    const finalHtml = `
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rajdhani:wght@700&display=swap');
body { margin:0; overflow:hidden; background:transparent; font-family:'Rajdhani',sans-serif; user-select:none; }
#battle-scene {
  width:100vw; height:100vh; display:flex; flex-direction:column; justify-content:space-between;
  background:transparent; position:relative; overflow:hidden;
}
/* HUD */
.hud { padding:10px 20px; display:flex; justify-content:space-between; z-index:10; }
.unit-stat { width:40%; }
.name { color:#fff; font-weight:800; text-shadow:2px 2px 0 #000; font-size:16px; margin-bottom:5px; text-transform:uppercase; }
.hp-frame { width:100%; height:15px; background:#222; border:2px solid #fff; border-radius:10px; overflow:hidden; position:relative; }
.hp-val { width:100%; height:100%; transition:width 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
#hero-hp { background:#00e5ff; box-shadow:0 0 10px #00e5ff; }
#boss-hp { background:#ff0055; box-shadow:0 0 10px #ff0055; }

/* SPRITES */
.stage { flex:1; position:relative; display:flex; justify-content:space-between; align-items:flex-end; padding:0 5%; }
.sprite { max-width:40%; max-height:80%; transition: transform 0.2s, filter 0.2s, opacity 0.5s; filter:drop-shadow(0 0 10px rgba(0,0,0,0.5)); position:relative; }
#hero-img { animation: idle 3s ease-in-out infinite; }
#boss-img { animation: idle 4s ease-in-out infinite reverse; }

/* MENU */
.menu { background: linear-gradient(to top, #000 90%, transparent); padding:10px; display:flex; flex-direction:column; align-items:center; z-index:20; min-height:140px; }
.q-box { 
  background:rgba(0,40,80,0.9); border:2px solid #00e5ff; color:#fff; padding:10px; 
  border-radius:8px; width:90%; text-align:center; font-size:18px; margin-bottom:10px;
  box-shadow:0 0 15px rgba(0,229,255,0.2); font-weight:700;
}
.btns { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; width:100%; }
.game-btn {
  background:#333; border:1px solid #666; color:#fff; padding:10px 20px;
  font-family:'Rajdhani',sans-serif; font-weight:700; font-size:16px; cursor:pointer;
  text-transform:uppercase; border-radius:4px; transition:0.1s; flex:1; min-width:120px; max-width:200px;
}
.game-btn:hover { background:#555; transform:translateY(-2px); border-color:#fff; }
.game-btn:active { transform:translateY(1px); }

/* EFFECTS */
.dmg-text {
  position:absolute; font-family:'Press Start 2P', cursive; font-size:20px; color:#fff;
  text-shadow:2px 2px 0 #000; animation: floatUp 1s forwards; pointer-events:none; z-index:100;
}
.crit { color:#ffcc00; font-size:24px; }
.miss { color:#aaa; font-size:16px; }

/* ANIMATIONS */
@keyframes idle { 0%,100% {transform:translateY(0)} 50% {transform:translateY(-10px)} }
@keyframes attackRight { 0% {transform:translateX(0)} 50% {transform:translateX(100px)} 100% {transform:translateX(0)} }
@keyframes shake { 0% {transform:translate(0,0)} 25% {transform:translate(5px,5px)} 50% {transform:translate(-5px,-5px)} 75% {transform:translate(5px,-5px)} 100% {transform:translate(0,0)} }
@keyframes floatUp { 0% {opacity:1; transform:translateY(0) scale(1);} 100% {opacity:0; transform:translateY(-50px) scale(1.5);} }
@keyframes flashRed { 0%,100% {filter:brightness(1) hue-rotate(0deg);} 50% {filter:brightness(2) sepia(1) hue-rotate(-50deg) saturate(5);} }
@keyframes victoryJump { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-30px)} }
</style>
</head>
<body>
<div id="battle-scene">
  <div class="hud">
    <div class="unit-stat">
      <div class="name">${state.heroName}</div>
      <div class="hp-frame"><div class="hp-val" id="hero-hp"></div></div>
    </div>
    <div class="unit-stat" style="text-align:right">
      <div class="name">${state.bossName}</div>
      <div class="hp-frame"><div class="hp-val" id="boss-hp"></div></div>
    </div>
  </div>

  <div class="stage">
    <img src="${state.heroImg}" id="hero-img" class="sprite">
    <img src="${state.bossImg}" id="boss-img" class="sprite">
  </div>

  <div class="menu">
    <div class="q-box" id="q-text">${state.question}</div>
    <div class="btns" id="btn-container">
      ${buttonsHtml}
    </div>
  </div>
</div>

<script>
  let heroHp = 100;
  let bossHp = 100;
  
  function spawnText(text, x, y, type) {
    const el = document.createElement('div');
    el.className = 'dmg-text ' + type;
    el.innerText = text;
    el.style.left = x + 'px';
    el.style.top = y + 'px';
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 1000);
  }

  function attack(isCorrect) {
    const hero = document.getElementById('hero-img');
    const boss = document.getElementById('boss-img');
    const qBox = document.getElementById('q-text');
    const btns = document.querySelectorAll('.game-btn');
    
    // Блокируем кнопки
    btns.forEach(b => b.disabled = true);

    if (isCorrect) {
      // WIN LOGIC
      hero.style.animation = 'attackRight 0.4s ease';
      
      setTimeout(() => {
        // Impact
        boss.style.animation = 'shake 0.4s linear, flashRed 0.4s ease';
        const rect = boss.getBoundingClientRect();
        spawnText("-9999", rect.left + rect.width/2, rect.top, 'crit');
        
        document.getElementById('boss-hp').style.width = '0%';
        
        setTimeout(() => {
          boss.style.opacity = '0';
          qBox.innerHTML = "<span style='color:#00ff88'>${state.winMsg}</span>";
          qBox.style.borderColor = "#00ff88";
          hero.style.animation = 'victoryJump 0.8s ease infinite';
        }, 600);
      }, 200);

    } else {
      // LOSE LOGIC (Try Again)
      document.body.style.animation = 'shake 0.3s linear';
      
      setTimeout(() => {
        hero.style.animation = 'flashRed 0.4s ease';
        const rect = hero.getBoundingClientRect();
        spawnText("MISS", rect.left + rect.width/2, rect.top, 'miss');
        
        heroHp -= 20;
        if(heroHp < 0) heroHp = 0;
        document.getElementById('hero-hp').style.width = heroHp + '%';
        
        qBox.innerText = "MISSED! TRY AGAIN!";
        qBox.style.color = "#ff0055";
        qBox.style.borderColor = "#ff0055";

        setTimeout(() => {
          // Reset
          document.body.style.animation = '';
          hero.style.animation = 'idle 3s ease-in-out infinite';
          qBox.style.color = "#fff";
          qBox.style.borderColor = "#00e5ff";
          qBox.innerText = "${state.question}";
          btns.forEach(b => b.disabled = false);
        }, 1500);
      }, 100);
    }
  }
<\/script>
</body>
</html>`;

    // Копирование
    const buffer = document.getElementById('code-buffer');
    // Оборачиваем в iframe для Genially
    buffer.value = `<iframe srcdoc="${finalHtml.replace(/"/g, '&quot;')}" width="100%" height="100%" frameborder="0" style="background:transparent;"></iframe>`;
    buffer.select();
    document.execCommand('copy');

    // Анимация кнопки
    const btn = document.querySelector('.btn-copy');
    const oldTxt = btn.innerText;
    btn.innerText = "СКОПИРОВАНО! / COPIED!";
    btn.style.background = "#00ff88";
    setTimeout(() => {
      btn.innerText = oldTxt;
      btn.style.background = "";
    }, 2000);
  }
  
  // Старт
  init();
</script>
</body>
</html>
