<div id="FX_ROOT">
  <style>
    /* --- ШРИФТЫ --- */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');

    /* --- CSS ПЕРЕМЕННЫЕ --- */
    #FX_ROOT {
      --bg-dark: #050505;
      --bg-panel: rgba(20, 20, 25, 0.9);
      --primary: #ff0055;  /* Розовый акцент */
      --secondary: #00e5ff; /* Голубой акцент */
      --success: #00ff88;   /* Зеленый для галочки */
      --text-main: #ffffff;
      --text-muted: #888;
      --border: rgba(255, 255, 255, 0.1);
      
      width: 100%;
      height: 100%;
      font-family: 'Montserrat', sans-serif;
      background-color: var(--bg-dark);
      /* Абстрактный фон */
      background-image: 
        radial-gradient(circle at 50% 50%, rgba(255, 0, 85, 0.05) 0%, transparent 60%),
        linear-gradient(0deg, rgba(0,0,0,1) 0%, rgba(10,10,15,0) 100%);
      color: var(--text-main);
      overflow: hidden;
      position: relative;
      display: flex;
      flex-direction: column;
    }

    #FX_ROOT * { box-sizing: border-box; outline: none; }

    /* Скроллбар */
    #FX_ROOT ::-webkit-scrollbar { width: 4px; }
    #FX_ROOT ::-webkit-scrollbar-track { background: transparent; }
    #FX_ROOT ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
    #FX_ROOT ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

    /* --- ГЛАВНАЯ (LANDING) --- */
    #FX_ROOT .landing-view {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 20;
      background: var(--bg-dark);
      transition: transform 0.6s cubic-bezier(0.7, 0, 0.3, 1), opacity 0.5s;
    }
    #FX_ROOT .landing-view.hidden {
      transform: translateY(-100%);
      pointer-events: none;
      opacity: 0;
    }

    /* Заголовок на главной */
    #FX_ROOT .landing-title {
      font-size: 80px;
      line-height: 1;
      font-weight: 900;
      text-transform: uppercase;
      text-align: center;
      color: transparent;
      -webkit-text-stroke: 2px rgba(255,255,255,0.8);
      position: relative;
      margin-bottom: 60px;
      letter-spacing: 4px;
    }
    #FX_ROOT .landing-title::after {
      content: attr(data-text);
      position: absolute;
      left: 0; top: 0; width: 100%; height: 100%;
      color: var(--text-main);
      opacity: 0;
      animation: neonFlicker 4s infinite;
      text-shadow: 0 0 30px var(--secondary);
    }
    @keyframes neonFlicker {
      0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; }
      20%, 24%, 55% { opacity: 0; }
    }

    /* Кнопка Старт */
    #FX_ROOT .btn-hero {
      padding: 25px 60px;
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #fff;
      background: transparent;
      border: 2px solid var(--primary);
      position: relative;
      cursor: pointer;
      overflow: hidden;
      transition: 0.3s;
      box-shadow: 0 0 20px rgba(255, 0, 85, 0.2);
    }
    #FX_ROOT .btn-hero::before {
      content: '';
      position: absolute;
      top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
      transition: 0.5s;
    }
    #FX_ROOT .btn-hero:hover {
      box-shadow: 0 0 50px rgba(255, 0, 85, 0.6);
      text-shadow: 0 0 10px white;
      background: rgba(255, 0, 85, 0.1);
    }
    #FX_ROOT .btn-hero:hover::before { left: 100%; }

    /* --- РЕДАКТОР (EDITOR) --- */
    #FX_ROOT .editor-view {
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      opacity: 0;
      transition: opacity 1s 0.5s;
    }
    #FX_ROOT .editor-view.visible { opacity: 1; }

    /* Шапка */
    #FX_ROOT .editor-header {
      height: 50px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      border-bottom: 1px solid var(--border);
      background: rgba(0,0,0,0.5);
    }
    #FX_ROOT .editor-logo { font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
    #FX_ROOT .btn-back {
      background: none; border: none; color: var(--text-muted);
      cursor: pointer; font-weight: 700; text-transform: uppercase; font-size: 11px;
      transition: 0.2s;
    }
    #FX_ROOT .btn-back:hover { color: #fff; }

    /* Основная сетка редактора */
    #FX_ROOT .editor-layout {
      flex: 1;
      display: flex; /* Flex вместо Grid для лучшего контроля ширины */
      overflow: hidden;
    }

    /* Левая панель (Инструменты) - Фиксированная ширина */
    #FX_ROOT .sidebar {
      width: 320px;
      background: var(--bg-panel);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      padding: 20px;
      overflow-y: auto;
      gap: 20px;
      flex-shrink: 0; /* Не сжимать */
      z-index: 10;
    }

    /* Правая панель (Превью) - Занимает всё остальное */
    #FX_ROOT .preview-area {
      flex: 1;
      position: relative;
      background-color: #000;
      /* Сетка для прозрачности */
      background-image: 
        linear-gradient(45deg, #111 25%, transparent 25%), 
        linear-gradient(-45deg, #111 25%, transparent 25%), 
        linear-gradient(45deg, transparent 75%, #111 75%), 
        linear-gradient(-45deg, transparent 75%, #111 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    /* Контролы */
    #FX_ROOT .group-title {
      font-size: 10px; text-transform: uppercase;
      color: var(--secondary); margin-bottom: 8px; font-weight: 800; letter-spacing: 1px;
    }
    #FX_ROOT .control-box {
      background: rgba(255,255,255,0.03);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    /* Инпут файла */
    #FX_ROOT .file-upload-wrap {
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    #FX_ROOT input[type="file"] {
      display: none; 
    }
    #FX_ROOT .btn-upload {
      flex: 1;
      background: rgba(255,255,255,0.1);
      border: 1px dashed var(--text-muted);
      color: #fff;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      text-align: center;
      transition: 0.2s;
    }
    #FX_ROOT .btn-upload:hover { border-color: var(--secondary); color: var(--secondary); background: rgba(0, 229, 255, 0.05); }
    
    /* Галочка успеха */
    #FX_ROOT .success-mark {
      color: var(--success);
      font-size: 18px;
      opacity: 0;
      transform: scale(0.5);
      transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    #FX_ROOT .success-mark.show { opacity: 1; transform: scale(1); }

    /* Обычные инпуты */
    #FX_ROOT input[type="text"] {
      width: 100%; background: #000; border: 1px solid var(--border);
      color: #fff; padding: 8px; border-radius: 4px; font-size: 11px; margin-top: 5px;
    }
    #FX_ROOT input[type="range"] {
      width: 100%; -webkit-appearance: none; height: 4px; background: rgba(255,255,255,0.1);
      border-radius: 2px; margin: 10px 0;
    }
    #FX_ROOT input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; width: 16px; height: 16px; background: var(--secondary);
      border-radius: 50%; cursor: pointer; border: 2px solid #000;
    }

    /* Табы анимаций */
    #FX_ROOT .anim-grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 5px;
    }
    #FX_ROOT .anim-btn {
      background: rgba(255,255,255,0.05); border: 1px solid transparent;
      color: var(--text-muted); padding: 8px; font-size: 10px; text-transform: uppercase;
      cursor: pointer; border-radius: 4px; transition: 0.2s;
    }
    #FX_ROOT .anim-btn:hover { background: rgba(255,255,255,0.1); }
    #FX_ROOT .anim-btn.active {
      background: rgba(0, 229, 255, 0.15); color: var(--secondary); border-color: var(--secondary);
    }

    /* Превью персонажа */
    #FX_ROOT .char-wrapper { transition: transform 0.1s; display: flex; justify-content: center; }
    #FX_ROOT .char-img {
      max-height: 80vh; /* Ограничиваем высоту, чтобы не вылезал */
      max-width: 100%;
      object-fit: contain;
      display: block;
    }
    /* Заглушка, если картинки нет */
    #FX_ROOT .char-placeholder {
      color: var(--border);
      font-size: 12px;
      text-transform: uppercase;
      border: 1px dashed var(--border);
      padding: 40px;
      border-radius: 10px;
    }

    /* Код панель */
    #FX_ROOT .code-area {
      position: absolute; bottom: 20px; right: 20px; width: 300px;
      background: #000; border: 1px solid var(--border); border-radius: 8px;
      display: flex; flex-direction: column; overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    #FX_ROOT textarea {
      background: transparent; border: none; color: var(--text-muted);
      font-family: monospace; font-size: 10px; padding: 10px; resize: none; height: 60px;
    }
    #FX_ROOT .btn-copy {
      background: var(--secondary); color: #000; border: none; padding: 8px;
      font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 11px;
      transition: 0.2s;
    }
    #FX_ROOT .btn-copy:hover { background: #fff; }

    /* АДАПТИВНОСТЬ */
    @media (max-width: 800px) {
      #FX_ROOT .editor-layout { flex-direction: column-reverse; }
      #FX_ROOT .sidebar { width: 100%; height: 40%; }
      #FX_ROOT .preview-area { height: 60%; }
      #FX_ROOT .landing-title { font-size: 40px; }
    }

    /* КЛЮЧЕВЫЕ КАДРЫ АНИМАЦИИ (ГЕНЕРИРУЕМЫЕ) */
    @keyframes fx-idle { 0%,100% {transform:translateY(0)} 50% {transform:translateY(-6px)} }
    @keyframes fx-float { 0%,100% {transform:translateY(0) rotate(0deg)} 50% {transform:translateY(-15px) rotate(2deg)} }
    @keyframes fx-pulse { 0%,100% {transform:scale(1)} 50% {transform:scale(1.05)} }
    @keyframes fx-shake { 0% {transform: translate(1px, 1px)} 20% {transform: translate(-3px, 0px)} 40% {transform: translate(1px, -1px)} 60% {transform: translate(-3px, 1px)} 80% {transform: translate(-1px, -1px)} 100% {transform: translate(1px, -2px)} }
    @keyframes fx-glitch { 0% {transform: translate(0)} 20% {transform: translate(-2px, 2px)} 40% {transform: translate(-2px, -2px)} 60% {transform: translate(2px, 2px)} 80% {transform: translate(2px, -2px)} 100% {transform: translate(0)} }
    @keyframes fx-spin { 0% {transform: rotateY(0deg)} 100% {transform: rotateY(360deg)} }
    @keyframes fx-neon { 0%,100% {opacity: 1; filter: brightness(1)} 50% {opacity: 0.8; filter: brightness(1.5)} }
    
    /* Классы для JS превью */
    #FX_ROOT .anim-idle { animation: fx-idle var(--dur) ease-in-out infinite; }
    #FX_ROOT .anim-float { animation: fx-float var(--dur) ease-in-out infinite; }
    #FX_ROOT .anim-pulse { animation: fx-pulse var(--dur) ease-in-out infinite; }
    #FX_ROOT .anim-shake { animation: fx-shake var(--dur) linear infinite; }
    #FX_ROOT .anim-glitch { animation: fx-glitch var(--dur) steps(2) infinite; }
    #FX_ROOT .anim-spin { animation: fx-spin var(--dur) linear infinite; }
    #FX_ROOT .anim-neon { animation: fx-neon var(--dur) steps(3) infinite; }
  </style>

  <!-- LANDING PAGE -->
  <div class="landing-view" id="fx_landing">
    <div class="landing-title" data-text="CHARACTER FX">CHARACTER FX</div>
    <button class="btn-hero" id="fx_btn_start">СОЗДАТЬ</button>
  </div>

  <!-- EDITOR PAGE -->
  <div class="editor-view" id="fx_editor">
    <div class="editor-header">
      <div class="editor-logo">FX <span>Editor</span></div>
      <button class="btn-back" id="fx_btn_back">← На главную</button>
    </div>

    <div class="editor-layout">
      <!-- SIDEBAR (TOOLS) -->
      <div class="sidebar">
        <!-- Upload -->
        <div class="control-box">
          <div class="group-title">Изображение</div>
          <div class="file-upload-wrap">
            <label class="btn-upload">
              Загрузить с ПК
              <input type="file" id="fx_file_input" accept="image/*">
            </label>
            <div class="success-mark" id="fx_upload_success">✔</div>
          </div>
          <div style="margin-top:10px; font-size:9px; color:var(--text-muted); text-align:center;">ИЛИ ССЫЛКА</div>
          <input type="text" id="fx_img_url" placeholder="https://...">
        </div>

        <!-- Animation -->
        <div class="control-box">
          <div class="group-title">Анимация</div>
          <div class="anim-grid">
            <div class="anim-btn active" data-anim="none">Нет</div>
            <div class="anim-btn" data-anim="idle">Дыхание</div>
            <div class="anim-btn" data-anim="float">Парение</div>
            <div class="anim-btn" data-anim="pulse">Пульс</div>
            <div class="anim-btn" data-anim="glitch">Глитч</div>
            <div class="anim-btn" data-anim="shake">Тряска</div>
            <div class="anim-btn" data-anim="spin">3D Спин</div>
            <div class="anim-btn" data-anim="neon">Неон</div>
          </div>
        </div>

        <!-- Effects -->
        <div class="control-box">
          <div class="group-title">Настройки</div>
          
          <label style="font-size:10px; color:#aaa;">Прозрачность: <span id="val_opacity">100%</span></label>
          <input type="range" id="fx_opacity" min="0" max="100" value="100">

          <label style="font-size:10px; color:#aaa;">Размер: <span id="val_size">100%</span></label>
          <input type="range" id="fx_size" min="50" max="150" value="100">

          <label style="font-size:10px; color:#aaa;">Скорость: <span id="val_speed">1.0x</span></label>
          <input type="range" id="fx_speed" min="0.5" max="3" step="0.1" value="1">
          
          <div style="display:flex; align-items:center; gap:10px; margin-top:10px;">
             <label style="font-size:10px; color:#aaa;">Свечение:</label>
             <input type="color" id="fx_glow_color" value="#ff0055" style="border:none; width:20px; height:20px; padding:0; background:none;">
             <input type="range" id="fx_glow_power" min="0" max="50" value="0" style="margin:0; flex:1;">
          </div>
        </div>
      </div>

      <!-- PREVIEW AREA -->
      <div class="preview-area">
        <div class="char-wrapper" id="fx_wrapper">
          <!-- Картинка появится здесь -->
          <div class="char-placeholder" id="fx_placeholder">Загрузите изображение</div>
          <img src="" id="fx_preview_img" class="char-img" style="display:none;">
        </div>

        <!-- CODE POPUP -->
        <div class="code-area">
          <textarea id="fx_code" readonly onclick="this.select()"></textarea>
          <button class="btn-copy" id="fx_btn_copy">КОПИРОВАТЬ КОД</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function() {
      const root = document.getElementById('FX_ROOT');
      
      // Элементы
      const ui = {
        landing: root.querySelector('#fx_landing'),
        editor: root.querySelector('#fx_editor'),
        imgUrl: root.querySelector('#fx_img_url'),
        fileInput: root.querySelector('#fx_file_input'),
        successMark: root.querySelector('#fx_upload_success'),
        
        previewImg: root.querySelector('#fx_preview_img'),
        placeholder: root.querySelector('#fx_placeholder'),
        wrapper: root.querySelector('#fx_wrapper'),
        
        inputs: {
          opacity: root.querySelector('#fx_opacity'),
          size: root.querySelector('#fx_size'),
          speed: root.querySelector('#fx_speed'),
          glowColor: root.querySelector('#fx_glow_color'),
          glowPower: root.querySelector('#fx_glow_power')
        },
        labels: {
          opacity: root.querySelector('#val_opacity'),
          size: root.querySelector('#val_size'),
          speed: root.querySelector('#val_speed')
        },
        code: root.querySelector('#fx_code'),
        animBtns: root.querySelectorAll('.anim-btn')
      };

      let state = {
        anim: 'none',
        currentSrc: '' // Хранит текущую картинку (URL или Base64)
      };

      // --- 1. ПЕРЕКЛЮЧЕНИЕ ЭКРАНОВ ---
      root.querySelector('#fx_btn_start').onclick = () => {
        ui.landing.classList.add('hidden');
        ui.editor.classList.add('visible');
      };
      root.querySelector('#fx_btn_back').onclick = () => {
        ui.landing.classList.remove('hidden');
        ui.editor.classList.remove('visible');
      };

      // --- 2. ЗАГРУЗКА ИЗОБРАЖЕНИЯ ---
      
      // А. Через ссылку
      ui.imgUrl.addEventListener('input', (e) => {
        if(e.target.value.trim() !== '') {
          loadImage(e.target.value);
          ui.successMark.classList.remove('show'); // Сброс галочки для URL
        }
      });

      // Б. Через файл (Base64)
      ui.fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(evt) {
            loadImage(evt.target.result);
            // Показываем галочку
            ui.successMark.classList.add('show');
            // Очищаем поле URL чтобы не путать
            ui.imgUrl.value = ''; 
          };
          reader.readAsDataURL(file);
        }
      });

      function loadImage(src) {
        state.currentSrc = src;
        ui.previewImg.src = src;
        ui.previewImg.style.display = 'block';
        ui.placeholder.style.display = 'none';
        update();
      }

      // --- 3. УПРАВЛЕНИЕ АНИМАЦИЯМИ ---
      ui.animBtns.forEach(btn => {
        btn.onclick = () => {
          ui.animBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.anim = btn.dataset.anim;
          update();
        }
      });

      // --- 4. ОСНОВНАЯ ЛОГИКА ОБНОВЛЕНИЯ ---
      function update() {
        if(!state.currentSrc) return; // Не обновлять если нет картинки

        const size = ui.inputs.size.value;
        const opacity = ui.inputs.opacity.value;
        const speed = ui.inputs.speed.value;
        const glowColor = ui.inputs.glowColor.value;
        const glowPower = ui.inputs.glowPower.value;

        // Обновление цифр
        ui.labels.size.innerText = size + '%';
        ui.labels.speed.innerText = speed + 'x';
        ui.labels.opacity.innerText = opacity + '%';

        // Применение стилей к превью
        ui.wrapper.style.transform = `scale(${size/100})`;
        ui.previewImg.style.opacity = opacity / 100;
        
        // Сброс и установка класса анимации
        ui.previewImg.className = 'char-img';
        if(state.anim !== 'none') ui.previewImg.classList.add('anim-' + state.anim);

        // Расчет скорости анимации
        const duration = (state.anim === 'shake' ? 0.8 : 2) / speed;
        ui.previewImg.style.setProperty('--dur', duration + 's');

        // Фильтр свечения
        const filter = glowPower > 0 ? `drop-shadow(0 0 ${glowPower}px ${glowColor})` : 'none';
        ui.previewImg.style.filter = filter;

        generateCode(state.currentSrc, size, opacity, filter, duration, state.anim);
      }

      // Слушатели инпутов
      Object.values(ui.inputs).forEach(inp => inp.addEventListener('input', update));

      // --- 5. ГЕНЕРАЦИЯ КОДА ---
      function generateCode(src, size, opacity, filter, dur, animType) {
        // Определение CSS анимации для вставки
        let animCss = '';
        let animClassDef = '';
        
        if (animType !== 'none') {
           // Получаем CSS keyframes из <style> (упрощенно копируем логику)
           // Для реального использования лучше вставить мини-версию keyframes прямо в код
           const timing = (animType === 'glitch') ? 'steps(2)' : (animType === 'shake' || animType === 'spin' ? 'linear' : 'ease-in-out');
           animCss = `animation: fx-${animType} ${dur}s infinite ${timing};`;
        }

        // Формируем HTML блок
        // ВНИМАНИЕ: Если картинка Base64, код будет длинным. Это нормально для client-side.
        const htmlBlock = `
<div style="display:flex;justify-content:center;align-items:center;height:100vh;overflow:hidden;background:transparent;">
  <style>
    @keyframes fx-idle { 0%,100% {transform:translateY(0)} 50% {transform:translateY(-6px)} }
    @keyframes fx-float { 0%,100% {transform:translateY(0) rotate(0deg)} 50% {transform:translateY(-15px) rotate(2deg)} }
    @keyframes fx-pulse { 0%,100% {transform:scale(1)} 50% {transform:scale(1.05)} }
    @keyframes fx-shake { 0% {transform: translate(1px, 1px)} 20% {transform: translate(-3px, 0px)} 40% {transform: translate(1px, -1px)} 60% {transform: translate(-3px, 1px)} 80% {transform: translate(-1px, -1px)} 100% {transform: translate(1px, -2px)} }
    @keyframes fx-glitch { 0% {transform: translate(0)} 20% {transform: translate(-2px, 2px)} 40% {transform: translate(-2px, -2px)} 60% {transform: translate(2px, 2px)} 80% {transform: translate(2px, -2px)} 100% {transform: translate(0)} }
    @keyframes fx-spin { 0% {transform: rotateY(0deg)} 100% {transform: rotateY(360deg)} }
    @keyframes fx-neon { 0%,100% {opacity: 1; filter: brightness(1) ${filter};} 50% {opacity: 0.8; filter: brightness(1.5) ${filter};} }
  </style>
  <div style="transform:scale(${size/100}); opacity:${opacity/100};">
    <img src="${src}" style="max-width:100%; display:block; ${animCss} filter:${filter};">
  </div>
</div>`;

        // Генерируем iframe код
        ui.code.value = `<iframe srcdoc="${htmlBlock.replace(/"/g, '&quot;')}" width="100%" height="100%" frameborder="0" style="background:transparent;"></iframe>`;
      }

      // Кнопка копирования
      root.querySelector('#fx_btn_copy').onclick = function() {
        ui.code.select();
        document.execCommand('copy');
        const originalText = this.innerText;
        this.innerText = 'СКОПИРОВАНО!';
        this.style.background = '#00ff88';
        setTimeout(() => {
          this.innerText = originalText;
          this.style.background = '';
        }, 1500);
      };

    })();
  </script>
</div>
    
